<!DOCTYPE html>
<html>
<head>
    <title>Login | PharmaKeys</title>
    <meta name="description" content="PharmaKeys intranet website">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes">
    <link rel="shortcut icon" href="/web/assets/img/favicon-cocori-coach.ico"/>
    <link rel="icon" type="image/x-icon" href="#"/>

    <!-- Bootstrap -->
    <link href="../css/application.css" rel="stylesheet">
    <script src="../js/application.js" ></script>
    <style> /* set the CSS */
	    path { 
	        stroke: steelblue;
	        stroke-width: 2;
	        fill: none;
	    }
	    .axis path,
	    .axis line {
	        fill: none;
	        stroke: grey;
	        stroke-width: 1;
	        shape-rendering: crispEdges;
	    }
	    #tunisiamap svg {
	      border: 1px solid #ccc;
	    }
	    #tunisiamap path {
	      fill: #ccc;
	      stroke: #fff;
	      stroke-width: .5px;
	    }
	    #tunisiamap path:hover {
	      fill: #00AEEC;
	    }
	  </style>
    <!--[if lt IE 9]>
    <script src="/web/assets/js/html5shiv.js"></script>
    <script src="/web/assets/js/respond.js"></script>
    <![endif]-->
</head>
<body>
	<nav class="navbar navbar-absolute-top pharma-nav">
		<div class="container-fluid">
		    <!-- Brand and toggle get grouped for better mobile display -->
		    <div class="row">
		        <div class="col-xs-2 visible-xs navbar-header-column">
		            <div class="navbar-header">
		                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
		                        data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
		                    <span class="sr-only">Toggle navigation</span>
		                    <span class="icon-bar"></span>
		                    <span class="icon-bar"></span>
		                    <span class="icon-bar"></span>
		                    <span class="icon-bar"></span>
		                </button>
		            </div>
		        </div>
		        <div class="col-xs-8 col-sm-2 navbar-brand-column">
		            <a class="navbar-brand" href="/">
		                <img class="logo" src="../images/logo_pharmakeys.png" alt="Logo PharmaKeys" width="120" />
		            </a>
		        </div>
		        <div class="col-xs-12 col-sm-10">
		            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		                <ul class="nav navbar-nav navbar-right">
		                    <li class="hidden-xs">
		                        <a class="blue-link" href="/devenir-coach">Change Password</a>
		                    </li>
		                    <li>
		                    	<a class="top-link" href="/devenir-coach">Help</a>
		                    </li>
		                    <li>
		                    	<a class="top-link" href="login.html">Logout</a>
		                    </li>
		                </ul>
		            </div>
		        </div>

		        <div class="clearfix visible-xs"></div>
		    </div>
		</div>
	<!-- /.container-fluid -->
	</nav>
	<div class="container-fluid main-panel">

		  <ul class="nav nav-tabs">
		    <li class="active">
		    	<a data-toggle="tab" href="#activity">Activity</a>
		    </li>
		    <li>
		    	<a data-toggle="tab" href="#reports">Reports</a>
		    </li>
		    <li>
		    	<a data-toggle="tab" href="#calendar">Calendar</a>
		    </li>
		    <li>
		    	<a data-toggle="tab" href="#inbox">Presentations</a>
		    </li>
		    <li>
		    	<a data-toggle="tab" href="#overview">Overview</a>
		    </li>
		  </ul>

		<div class="tab-content">
			<div id="activity" class="tab-pane fade in active">
				<div class="row">
					<div class="col-md-2"></div>
					<div class="col-md-2">
						<h1>Data for: Bizert</h1>
					</div>
				</div>
			  <div class="row">
			    <div class="col-md-2">
			      <div id="tunisiamap"></div>
			    </div>
			    <div class="col-md-3">
			    	<h5>Pie chart demo (Overall visits attention)</h5> 
			      	<div id="piechart" style="max-height: 350px"></div>
			      	<div>
			    		<h3>Average visits done per day:</h3>
			    		<h4>12 Disclosed<br></h4>
			    		<h4>6 Not disclosed</h4>
			    	</div>
			    </div>
			    <div class="col-md-5">
			      <h5>Efficiency chh5>
			      <div id="linechart"></div>
			      <br><br>
			      <table class="table">
			      	<thead>
			      		<th></th>
			      		<th></th>
			      		<th>Pharmacies</th>
			      		<th>Hospitals</th>
			      		<th>Clinics</th>
			      		<th>Wholesaler</th>
			      		<th>Doctors</th>
			      		<th>Total</th>
			      	</thead>
			      	<tbody>
			      		<tr>
			      			<td>Cycle</td>
			      			<td>Week 1</td>
			      			<td>2</td>
			      			<td>1</td>
			      			<td>2</td>
			      			<td>3</td>
			      			<td>3</td>
			      			<td>11</td>
			      		</tr>
			      		<tr>
			      			<td></td>
			      			<td>Week 2</td>
			      			<td>2</td>
			      			<td>1</td>
			      			<td>0</td>
			      			<td>0</td>
			      			<td>1</td>
			      			<td>4</td>
			      		</tr>
			      		<tr>
			      			<td></td>
			      			<td>Week 3</td>
			      			<td>0</td>
			      			<td>0</td>
			      			<td>1</td>
			      			<td>1</td>
			      			<td>1</td>
			      			<td>3</td>
			      		</tr>
			      		<tr>
			      			<td></td>
			      			<td>Week 4</td>
			      			<td>0</td>
			      			<td>0</td>
			      			<td>1</td>
			      			<td>0</td>
			      			<td>1</td>
			      			<td>2</td>
			      		</tr>
			      	</tbody>
			      </table>
			    </div>
			  </div>
			  <div class="row">
			    <div class="col-md-2">
			    </div>
			    <div class="col-md-3" style="margin-bottom: 150px;">
			    </div>
			    
			  </div>
  
			</div>
			<div id="reports" class="tab-pane fade">
			  <h3>Menu 1</h3>
			  <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
			</div>
			<div id="calendar" class="tab-pane fade">
			  <h3>Menu 2</h3>
			  <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
			</div>
			<div id="inbox" class="tab-pane fade">
			  	<div class="row">
			  		<div class="col-md-4">
			  			<div class="form-group">
			  				<label for="presentation-title">Presentation Title</label>
					  		<input type="text" name="presentation-title" class="form-control">
					  	</div>
					  	<div class="form-group">
					  		<button class="btn btn-pharma" id="addslide">Add a slide</button>
					  		<button class="btn btn-primary" id="save-btn">Save</button>
					  	</div>
			  		</div>
			  	</div>
			  	<div class="row" id="slides" style="overflow-y: scroll; max-height: 500px;">

			  	</div>
			</div>
			<div id="overview" class="tab-pane fade">
			  <h2><strong>Account overview</strong></h2>
			  <div class="row">
			  	<div class="col-md-3 user-info">
			  		<img src="../images/faycel.png" width="200">
			  		<br>
			  		<label for="first-name">Full name</label>
			  		<div class="form-group">
			  			<input id="first-name" class="form-control" />
			  		</div>
			  		<label for="first-name">Full job title</label>
			  		<div class="form-group">
			  			<input id="first-name" class="form-control" />
			  		</div>
			  		<label for="first-name">Phone number</label>
			  		<div class="form-group">
			  			<input id="first-name" class="form-control" />
			  		</div>
			  		<label for="first-name">Email</label>
			  		<div class="form-group">
			  			<input id="first-name" class="form-control" />
			  		</div>
			  	</div>
			  	<div class="col-md-9 comm-info">
			  		<h2>
			  			<span class="blue-heading">Statistics</span>
			  		</h2>
			  		<div class="stat-box">
			  			<div class="row">
			  				<div class="col-md-3">
			  					<div class="panel">
					  				<div class="panel-body red-panel">
					  					<div class="row">
					  						<div class="col-md-4">
					  							<i class="fa fa-tag"></i>
					  						</div>
					  						<div class="col-md-8">
					  							Total sales
					  							<h4>4522 DT</h4>
					  						</div>
					  					</div>
					  				</div>
					  			</div>
			  				</div>
			  				<div class="col-md-3">
			  					<div class="panel">
					  				<div class="panel-body green-panel">
					  					<div class="row">
					  						<div class="col-md-4">
					  							<i class="fa fa-tag"></i>
					  						</div>
					  						<div class="col-md-8">
					  							Total Records
					  							<h4>4522 DT</h4>
					  						</div>
					  					</div>
					  				</div>
					  			</div>
			  				</div>
			  				<div class="col-md-3">
			  					<div class="panel">
					  				<div class="panel-body blue-panel">
					  					<div class="row">
					  						<div class="col-md-4">
					  							<i class="fa fa-tag"></i>
					  						</div>
					  						<div class="col-md-8">
					  							Total sales
					  							<h4>4522 DT</h4>
					  						</div>
					  					</div>
					  				</div>
					  			</div>
			  				</div>
			  				<div class="col-md-3">
			  					<div class="panel">
					  				<div class="panel-body navy-panel">
					  					<div class="row">
					  						<div class="col-md-4">
					  							<i class="fa fa-tag"></i>
					  						</div>
					  						<div class="col-md-8">
					  							Total sales
					  							<h4>4522 DT</h4>
					  						</div>
					  					</div>
					  				</div>
					  			</div>
			  				</div>
			  			</div>
			  		</div>
			  		<div class="row">
			  			<br>
			  			<div class="col-md-5">
			  				<h2>
					  			<span class="blue-heading">
					  				Communication options 
					  				<a href="">
					  					<i class="fa fa-plus"></i>
					  				</a>
					  				<a href="">
					  					<i class="fa fa-twitter"></i>
					  				</a>
					  				<a href="">
					  					<i class="fa fa-facebook"></i>
					  				</a>
					  			</span>
					  		</h2>
					  		<form>
					  			<table>
					  				<tr>
					  					<td><label for  = "user-phonenumber">Phone number</label></td>
					  					<td class="pull-right">
					  						<input type = "tel" name = "user-phonenumber" id="user-phonenumber">
				  						</td>
					  				</tr>
					  				<tr>
					  					<td><label for  = "user-skype">Skype</label></td>
					  					<td class="pull-right">
					  						<input type = "tel" name = "user-skype" id   = "user-skype">
				  						</td>
					  				</tr>
					  				<tr>
					  					<td><label for  = "user-facebook">Facebook</label></td>
					  					<td class="pull-right">
					  						<input type = "tel" name = "user-facebook" id   = "user-facebook">
				  						</td>
					  				</tr>
					  				<tr>
					  					<td><label for  = "user-twitter">Twitter</label></td>
					  					<td class="pull-right">
					  						<input type = "tel" name = "user-twitter" id   = "user-twitter">
				  						</td>
					  				</tr>
					  				<tr>
					  					<td><label for  = "user-dnsf">Do not show phone</label></td>
					  					<td class="pull-right">
					  						<select>
					  							<option value="true">Yes</option>
					  							<option value="false">No</option>
					  						</select>
				  						</td>
					  				</tr>
					  				<tr>
					  					<td><label for  = "user-phonenumber">Do not show email</label></td>
					  					<td class="pull-right">
					  						<select>
					  							<option value="true">Yes</option>
					  							<option value="false">No</option>
					  						</select>
				  						</td>
					  				</tr>
					  			</table>
				  			</form>
			  			</div>
			  			<div class="col-md-7">
			  				<h2>
					  			<span class="blue-heading">New tasks</span>
					  		</h2>
			  				<table class="table">
							  <thead class="thead-inverse thi">
							    <tr>
							      <th>#</th>
							      <th>Task</th>
							      <th>Due date</th>
							      <th>Notes</th>
							      <th></th>
							    </tr>
							  </thead>
							  <tbody>
							    <tr>
							      <th scope="row">1</th>
							      <td>Visit doctor in Ariena</td>
							      <td>15/06/2018</td>
							      <td>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
							      tempor incididunt ut labore et dolore magna aliqua.</td>
							      <td><button class="btn btn-pharma">Check</button></td>
							    </tr>
							    <tr>
							      <th scope="row">2</th>
							      <td>Visit doctor in Ariena</td>
							      <td>15/06/2018</td>
							      <td>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
							      tempor incididunt ut labore et dolore magna aliqua.</td>
							      <td><button class="btn btn-pharma">Check</button></td>
							    </tr>
							    <tr>
							      <th scope="row">3</th>
							      <td>Visit doctor in Ariena</td>
							      <td>15/06/2018</td>
							      <td>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
							      tempor incididunt ut labore et dolore magna aliqua.</td>
							      <td><button class="btn btn-pharma">Check</button></td>
							    </tr>
							  </tbody>
							</table>
			  			</div>
			  		</div>
		  			
			  	</div>
			  </div>
			</div>
		</div>
  	</div>

  
  <!-- load the d3.js library -->    
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>

  <script>

  	
    d3.json("http://localhost:3000/api/data2", function(error, data) {
        
        var margin = {top: 30, right: 20, bottom: 30, left: 50},
          width = 800 - margin.left - margin.right,
          height = 270 - margin.top - margin.bottom;

        data = data.filter((d) => d.at >= "2014-01-01" && d.at <= "2014-02-01");
        
        drawPieChart(data.filter((done) => done.status == "Done").length, 
                     data.filter((not_done) => not_done.status == "Not done").length);
        drawTunisiaMap();

        var visistBydDate = d3.nest()
          .key(function(d) { return d.at; })
          .entries(data);

        let formattedData = [];
        let maxX = 0;
        visistBydDate.forEach(function(d){
          let formattedD = {
            at:  new Date(d.key),
            done:   d.values.filter((x) => x.status == "Done").length,
            total:  d.values.length
          }
          formattedData.push(formattedD);
          maxX = (maxX < formattedD.total ? 
            formattedD.total :  maxX);
        });

        formattedData.sort(function(a, b){return a['at'] - b['at']});
        console.log("Formatted data:", formattedData);

        // Set the ranges
        var x = d3.time.scale().range([0, width]);
        var y = d3.scale.linear().range([height, 0]);

        

        // Define the axes
        var xAxis = d3.svg.axis().scale(x)
            .orient("bottom").ticks(formattedData.length);

        console.log(maxX);
        var yAxis = d3.svg.axis().scale(y)
            .orient("left").ticks(maxX);

        // Define the line
        var valueline = d3.svg.line()
            .x(function(d) { return x(d.at); })
            .y(function(d) { return y(d.total); });
        var valueline2 = d3.svg.line()
            .x(function(d) { return x(d.at); })
            .y(function(d) { return y(d.done); });
            
        // Adds the svg canvas
        var svg = d3.select("#linechart")
            .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .attr("transform", 
                      "translate(" + margin.left + "," + margin.top + ")");
         // Scale the range of the data
         x.domain(d3.extent(formattedData, function(d) { return d.at; }));
         y.domain([0, d3.max(formattedData  , function(d) { return d.total; })]);

         // Add the valueline path.
         svg.append("path")
             .attr("class", "line")
             .attr("d", valueline(formattedData));

             svg.append("path")
             .attr("class", "line")
             .style("stroke", "red")
             .attr("d", valueline2(formattedData));


          // Add the X Axis
         svg.append("g")
             .attr("class", "x axis")
             .attr("transform", "translate(1," + height + ")")
             .call(xAxis);

         // Add the Y Axis
         svg.append("g")
             .attr("class", "y axis")
             .call(yAxis);

         svg.append("text")
            .attr("transform", "translate(" + (width-10) + "," + y(formattedData[0].total + 0.15) + ")")
            .attr("dy", ".35em")
            .attr("text-anchor", "start")
            .style("fill", "blue")
            .text("Total");

         svg.append("text")
            .attr("transform", "translate(" + (width-10) + "," + y(formattedData[0].done - 0.85) + ")")
            .attr("dy", ".35em")
            .attr("text-anchor", "start")
            .style("fill", "red")
            .text("Done");

    });



    function drawPieChart(done, not_done){
      var w = 500,                        //width
      h = 500,                            //height
      r = 150,                            //radius
      color = d3.scale.category20();

      data = [
              {"label":"Done", "value":done},
              {"label":"Not Done", "value":not_done}
            ];
      
      var vis = d3.select("#piechart")
          .append("svg:svg")              //create the SVG element inside the <body>
          .data([data])                   //associate our data with the document
              .attr("width", w)           //set the width and height of our visualization (these will be attributes of the <svg> tag
              .attr("height", h)
          .append("svg:g")                //make a group to hold our pie chart
              .attr("transform", "translate(" + r + "," + r + ")")    //move the center of the pie chart from 0, 0 to radius, radius

      var arc = d3.svg.arc()              //this will create <path> elements for us using arc data
          .outerRadius(r);

      var pie = d3.layout.pie()           //this will create arc data for us given a list of values
          .value(function(d) { return d.value; });    //we must tell it out to access the value of each element in our data array

      var arcs = vis.selectAll("g.slice")     //this selects all <g> elements with class slice (there aren't any yet)
          .data(pie)                          //associate the generated pie data (an array of arcs, each having startAngle, endAngle and value properties) 
          .enter()                            //this will create <g> elements for every "extra" data element that should be associated with a selection. The result is creating a <g> for every object in the data array
              .append("svg:g")                //create a group to hold each slice (we will have a <path> and a <text> element associated with each slice)
                  .attr("class", "slice");    //allow us to style things in the slices (like text)

          arcs.append("svg:path")
                  .attr("fill", function(d, i) { return color(i); } ) //set the color for each slice to be chosen from the color function defined above
                  .attr("d", arc);                                    //this creates the actual SVG path using the associated data (pie) with the arc drawing function

          arcs.append("svg:text")                                     //add a label to each slice
                  .attr("transform", function(d) {                    //set the label's origin to the center of the arc
                  //we have to make sure to set these before calling arc.centroid
                  d.innerRadius = 0;
                  d.outerRadius = r;
                  return "translate(" + arc.centroid(d) + ")";        //this gives us a pair of coordinates like [50, 50]
              })
              .attr("text-anchor", "middle")                          //center the text on it's origin
              .text(function(d, i) { return data[i].label; });        //get the label from our original data array
    }

    function drawTunisiaMap(){

      var width = 220, height = 500;

      var path = d3.geo.path();

      var svg = d3.select("#tunisiamap").append("svg")
          .attr("width", width)
          .attr("height", height);

      d3.json("https://gist.githubusercontent.com/mohamed-ali/8732826/raw/901a577fafad6277e38f2c0f6bf09561fd4124c9/tunisia.json", function(error, topology) {

        console.log(topology);
        var featureCollection = topojson.feature(topology, topology.objects.governorates);
        var bounds = d3.geo.bounds(featureCollection);
        
        var centerX = d3.sum(bounds, function(d) {return d[0];}) / 1.15,
            centerY = d3.sum(bounds, function(d) {return d[1];}) / 2;

        var projection = d3.geo.mercator()
          .scale(3000)
          .center([centerX, centerY]);
          
        path.projection(projection);
        
        svg.selectAll("path")
            .data(featureCollection.features)
            .enter().append("path")
            .attr("d", path);
      });
    }
  </script>
  	<script type="text/javascript">
  		$('#addslide').on('click', function(e){
  			e.preventDefault();
  			$('#slides').append(`<div class="col-md-3">
			  			<div class="thumbnail">
			  				<img src="../images/placeholder.png" width="150">
			  				<div class="form-group">
			  					<label for="presentation-title">Choose image</label>
					  			<input type="file" class="form-control">
					  		</div>
			  				<div class="form-group">
			  					<label for="presentation-title">Duration</label>
					  			<input type="number" class="form-control">
					  		</div>
					  		<div class="form-group">
			  					<label>Fade mode</label>
					  			<input type="number" class="form-control">
					  		</div>
					  		<div class="form-group">
					  			<label>Description</label>
					  			<textarea class="form-control"></textarea>
					  		</div>
					  		<div class="form-group">
			  					<button class="btn btn-green">Ok</button>
					  		</div>
			  			</div>
			  		</div>`);
  		});
  	</script>
</body>
</html>